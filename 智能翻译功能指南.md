# iZsh 智能命令翻译功能使用指南

## 🎯 功能简介

iZsh 的智能命令翻译功能可以：
- ✅ **自动识别自然语言**：将"列目录"翻译成 `ls`
- ✅ **自动纠正拼写错误**：将"mkdri"纠正为 `mkdir`
- ✅ **支持中英文混合**：支持中文和英文描述
- ✅ **用户确认机制**：翻译后询问是否执行
- ✅ **智能参数保留**：保留用户输入的参数

---

## 🚀 快速开始

### 方法 1: 使用演示脚本（推荐首次体验）⭐

```bash
cd ~/Documents/ClaudeCode/zsh/zsh
./demo_智能翻译.sh
```

### 方法 2: 直接启动 iZsh

```bash
./start_izsh.sh
```

---

## 💡 使用示例

### 示例 1: 自然语言命令

在 iZsh 中输入：
```
列目录
```

AI 会自动翻译：
```
💡 未找到命令 '列目录'，正在使用 AI 智能翻译...

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
🤖 AI 建议执行：
   ls
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

是否执行此命令? [Y/n/e(编辑)]
```

按 `Y` 或 `Enter` 执行，按 `n` 取消，按 `e` 编辑。

---

### 示例 2: 拼写错误纠正

输入：
```
mkdri testdir
```

AI 翻译：
```
🤖 AI 建议执行：
   mkdir testdir
```

---

### 示例 3: 中文描述

输入：
```
查看文件 ~/.izshrc
```

AI 翻译：
```
🤖 AI 建议执行：
   cat ~/.izshrc
```

---

### 示例 4: 复杂操作

输入：
```
显示磁盘使用情况
```

AI 翻译：
```
🤖 AI 建议执行：
   df -h
```

---

### 示例 5: 文件操作

输入：
```
删除文件 old.log
```

AI 翻译：
```
🤖 AI 建议执行：
   rm old.log
```

---

## 🎮 交互选项

当 AI 给出建议后，您可以选择：

| 选项 | 说明 |
|------|------|
| **Y** 或 **Enter** | 立即执行建议的命令 |
| **n** | 取消执行 |
| **e** | 编辑模式 - 将命令放入输入行供修改 |

---

## ⚙️ 配置选项

### 干预级别设置

编辑 `~/.izshrc`，修改 `IZSH_AI_INTERVENTION_LEVEL`：

```bash
# 建议模式（默认）：询问用户确认
export IZSH_AI_INTERVENTION_LEVEL="suggest"

# 自动模式：直接执行（谨慎使用！）
export IZSH_AI_INTERVENTION_LEVEL="auto"

# 关闭模式：禁用智能翻译
export IZSH_AI_INTERVENTION_LEVEL="off"
```

### 模型选择

可以更换不同的 AI 模型：

```bash
# 使用 Claude Haiku（快速）
export IZSH_AI_MODEL="claude-3-5-haiku-20241022"

# 使用 Claude Sonnet（平衡）
export IZSH_AI_MODEL="claude-sonnet-4-5"

# 使用 Claude Opus（强大）
export IZSH_AI_MODEL="claude-opus-4-1-20250805"
```

---

## 📚 支持的命令类型

### ✅ 文件操作
```
列目录           → ls
查看文件 test.txt  → cat test.txt
删除文件 old.log   → rm old.log
复制文件 a.txt b.txt → cp a.txt b.txt
移动文件 old.txt new.txt → mv old.txt new.txt
```

### ✅ 目录操作
```
创建目录 testdir    → mkdir testdir
进入目录 /tmp      → cd /tmp
显示当前路径       → pwd
删除目录 olddir    → rm -rf olddir
```

### ✅ 系统信息
```
显示磁盘使用情况   → df -h
查看内存使用      → free -h (Linux) / top (macOS)
显示进程列表      → ps aux
查看系统信息      → uname -a
```

### ✅ 文本处理
```
搜索文件内容 keyword file.txt → grep keyword file.txt
统计行数 file.txt            → wc -l file.txt
排序文件 data.txt           → sort data.txt
```

### ✅ 网络操作
```
下载文件 url       → curl -O url / wget url
测试网络连接 host   → ping host
查看端口占用 8080   → lsof -i :8080 / netstat -an | grep 8080
```

### ✅ 拼写错误纠正
```
mkdri testdir  → mkdir testdir
cta file.txt   → cat file.txt
sl             → ls
grpe pattern   → grep pattern
```

---

## 🎨 工作流程

```
用户输入自然语言/错误命令
         ↓
   命令未找到
         ↓
  触发 command_not_found_handler
         ↓
  调用 AI API 翻译命令
         ↓
   显示建议的命令
         ↓
    用户确认选择
         ↓
  Y: 执行 | n: 取消 | e: 编辑
```

---

## 🔧 故障排查

### 问题 1: "AI 功能未启用"

**检查配置**：
```bash
# 在 iZsh 中执行
echo $IZSH_AI_ENABLED
# 应该输出: 1
```

**解决方案**：
编辑 `~/.izshrc`，确保：
```bash
export IZSH_AI_ENABLED=1
```

---

### 问题 2: "未配置 AI API 密钥"

**检查配置**：
```bash
echo $IZSH_AI_API_KEY
# 应该输出你的 API 密钥
```

**解决方案**：
编辑 `~/.izshrc`，设置：
```bash
export IZSH_AI_API_KEY="your-api-key"
```

---

### 问题 3: "AI 翻译失败"

**可能原因**：
- 网络连接问题
- API 配额用完
- API 服务不可用

**解决方案**：
1. 检查网络连接
2. 检查 API 配额
3. 尝试更换 API 服务

---

### 问题 4: 命令未被拦截

**检查 AI 模块是否加载**：
```bash
zmodload -e zsh/ai
echo $?
# 应该输出: 0
```

**解决方案**：
手动加载模块：
```bash
zmodload zsh/ai
```

或确保 `~/.izshrc` 中有自动加载代码。

---

## 🎓 高级技巧

### 技巧 1: 组合命令翻译

输入：
```
查找所有 txt 文件
```

AI 翻译：
```
find . -name "*.txt"
```

---

### 技巧 2: 管道命令翻译

输入：
```
列出前10个最大文件
```

AI 翻译：
```
du -ah | sort -rh | head -10
```

---

### 技巧 3: 带选项的命令

输入：
```
详细列出所有文件包括隐藏文件
```

AI 翻译：
```
ls -lAh
```

---

## 📊 性能优化

### 加速 AI 响应

1. **使用更快的模型**：
```bash
export IZSH_AI_MODEL="claude-3-5-haiku-20241022"
```

2. **减少调试输出**：
关闭调试模式可以加快响应速度。

3. **网络优化**：
确保网络连接稳定，使用国内可访问的 API 服务。

---

## 🔐 安全建议

### ⚠️ 注意事项

1. **谨慎使用自动模式**：
   - `auto` 模式会直接执行 AI 建议的命令
   - 推荐使用 `suggest` 模式，手动确认

2. **危险命令检查**：
   - 始终检查 AI 建议的命令
   - 特别注意 `rm -rf`, `chmod`, `chown` 等危险操作

3. **敏感数据保护**：
   - 不要输入包含密码、密钥的命令
   - AI API 会接收您的输入内容

---

## 💼 实际应用场景

### 场景 1: 新手学习

新手不记得命令，可以用自然语言：
```
新手: "怎么看文件内容"
iZsh: cat filename

新手: "怎么创建文件夹"
iZsh: mkdir dirname
```

### 场景 2: 快速原型

快速输入想法，无需记忆准确命令：
```
开发者: "找所有 Python 文件"
iZsh: find . -name "*.py"
```

### 场景 3: 跨平台操作

不确定具体命令在当前平台的写法：
```
用户: "查看内存使用"
iZsh: (macOS) top
iZsh: (Linux) free -h
```

---

## 📖 更多资源

- **技术文档**: `ANTHROPIC_API_INTEGRATION.md`
- **配置文件**: `~/.izshrc`
- **故障排查**: `常见问题解决.md`
- **源代码**: `Src/Modules/ai.c`

---

## 🎉 立即体验！

**最简单的方法**：
```bash
cd ~/Documents/ClaudeCode/zsh/zsh
./demo_智能翻译.sh
```

然后在 iZsh 中输入：
```
列目录
创建目录 test
查看文件 ~/.izshrc
```

体验智能命令翻译的魔力！✨

---

## 🤝 反馈与建议

如果您有任何问题或建议，欢迎：
- 查看 `常见问题解决.md`
- 阅读技术文档了解实现细节
- 根据需要调整配置参数

祝您使用愉快！🚀
