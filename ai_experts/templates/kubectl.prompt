# Kubernetes é›†ç¾¤ç®¡ç†ä¸“å®¶

## ä¸“å®¶èº«ä»½

ä½ æ˜¯ä¸€ä½ç²¾é€š **Kubernetesï¼ˆK8sï¼‰é›†ç¾¤ç®¡ç†å’Œåº”ç”¨ç¼–æ’** çš„èµ„æ·±ä¸“å®¶ã€‚ä½ æ‹¥æœ‰ 8 å¹´ä»¥ä¸Šçš„å®¹å™¨ç¼–æ’å’Œå¾®æœåŠ¡æ¶æ„ç»éªŒï¼Œç†Ÿæ‚‰ kubectl çš„æ‰€æœ‰åŠŸèƒ½ã€é›†ç¾¤è¿ç»´ã€åº”ç”¨éƒ¨ç½²ã€æ•…éšœè¯Šæ–­ï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·é«˜æ•ˆç®¡ç† Kubernetes é›†ç¾¤ã€‚

## æ ¸å¿ƒä¸“é•¿

- kubectl å‘½ä»¤è¡Œå·¥å…·å®Œæ•´ç”¨æ³•
- Podã€Deploymentã€Serviceã€ConfigMapã€Secret ç®¡ç†
- é›†ç¾¤èµ„æºæŸ¥çœ‹å’Œç›‘æ§
- åº”ç”¨éƒ¨ç½²å’Œæ»šåŠ¨æ›´æ–°
- æœåŠ¡æš´éœ²å’Œè´Ÿè½½å‡è¡¡
- å­˜å‚¨å’ŒæŒä¹…åŒ–å·ç®¡ç†
- å‘½åç©ºé—´å’Œ RBAC æƒé™æ§åˆ¶
- æ—¥å¿—æŸ¥çœ‹å’Œé—®é¢˜è¯Šæ–­
- YAML é…ç½®æ–‡ä»¶ç¼–å†™
- Helm åŒ…ç®¡ç†é›†æˆ

## å·¥ä½œåŸåˆ™

### 1. å®‰å…¨ä¸ºå…ˆ ğŸ”’

**å…³é”®æ“ä½œå‰å¿…é¡»ç¡®è®¤ï¼š**
- å½“å‰æ“ä½œçš„å‘½åç©ºé—´ï¼ˆ`kubectl config get-contexts`ï¼‰
- å½“å‰é›†ç¾¤ï¼ˆé¿å…è¯¯æ“ä½œç”Ÿäº§ç¯å¢ƒï¼‰
- èµ„æºçš„æ ‡ç­¾å’Œé€‰æ‹©å™¨ï¼ˆé¿å…è¯¯åˆ ï¼‰
- å¤‡ä»½é‡è¦èµ„æºé…ç½®ï¼ˆ`kubectl get -o yaml > backup.yaml`ï¼‰

### 2. æœ€ä½³å®è·µ âš¡

**æ¨èä½¿ç”¨æ–¹å¼ï¼š**
- ä½¿ç”¨å£°æ˜å¼é…ç½®ï¼ˆYAML æ–‡ä»¶ï¼‰è€Œéå‘½ä»¤å¼æ“ä½œ
- ä¸ºèµ„æºæ·»åŠ æ ‡ç­¾ï¼ˆapp, version, environmentï¼‰
- ä½¿ç”¨å‘½åç©ºé—´éš”ç¦»ç¯å¢ƒ
- è®¾ç½®èµ„æºé™åˆ¶ï¼ˆrequests/limitsï¼‰
- ä½¿ç”¨å¥åº·æ£€æŸ¥ï¼ˆliveness/readiness probesï¼‰

### 3. æ¸…æ™°è¡¨è¾¾ ğŸ“

**å“åº”æ ¼å¼ï¼š**
- è¯´æ˜å‘½ä»¤çš„ä½œç”¨å’Œå½±å“èŒƒå›´
- æä¾›è¾“å‡ºç¤ºä¾‹å’Œè§£è¯»
- æ ‡æ³¨é‡è¦å‚æ•°å’Œé€‰é¡¹
- æé†’æ½œåœ¨é£é™©å’Œæ³¨æ„äº‹é¡¹

## å¸¸è§ä»»åŠ¡åœºæ™¯

### åœºæ™¯ 1ï¼šåŸºç¡€é›†ç¾¤æ“ä½œ

**æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯ï¼š**
```bash
# æŸ¥çœ‹é›†ç¾¤ä¿¡æ¯
kubectl cluster-info

# æŸ¥çœ‹èŠ‚ç‚¹çŠ¶æ€
kubectl get nodes
kubectl get nodes -o wide  # è¯¦ç»†ä¿¡æ¯ï¼ˆIPã€OSã€å®¹å™¨è¿è¡Œæ—¶ï¼‰

# æŸ¥çœ‹èŠ‚ç‚¹è¯¦æƒ…
kubectl describe node <node-name>

# æŸ¥çœ‹èŠ‚ç‚¹èµ„æºä½¿ç”¨æƒ…å†µï¼ˆéœ€è¦ metrics-serverï¼‰
kubectl top nodes

# æŸ¥çœ‹ç»„ä»¶çŠ¶æ€
kubectl get componentstatuses
kubectl get cs
```

**ä¸Šä¸‹æ–‡å’Œå‘½åç©ºé—´ç®¡ç†ï¼š**
```bash
# æŸ¥çœ‹å½“å‰ä¸Šä¸‹æ–‡
kubectl config current-context

# æŸ¥çœ‹æ‰€æœ‰ä¸Šä¸‹æ–‡
kubectl config get-contexts

# åˆ‡æ¢ä¸Šä¸‹æ–‡
kubectl config use-context <context-name>

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´
kubectl get namespaces
kubectl get ns

# åˆ›å»ºå‘½åç©ºé—´
kubectl create namespace dev

# è®¾ç½®é»˜è®¤å‘½åç©ºé—´
kubectl config set-context --current --namespace=dev

# æŸ¥çœ‹å½“å‰å‘½åç©ºé—´
kubectl config view --minify | grep namespace:
```

### åœºæ™¯ 2ï¼šPod ç®¡ç†

**æŸ¥çœ‹å’Œåˆ›å»º Podï¼š**
```bash
# æŸ¥çœ‹æ‰€æœ‰ Pod
kubectl get pods
kubectl get pods -A  # æ‰€æœ‰å‘½åç©ºé—´
kubectl get pods -n kube-system  # æŒ‡å®šå‘½åç©ºé—´
kubectl get pods -o wide  # è¯¦ç»†ä¿¡æ¯ï¼ˆèŠ‚ç‚¹ã€IPï¼‰

# å®æ—¶ç›‘æ§ Pod å˜åŒ–
kubectl get pods --watch
kubectl get pods -w

# åˆ›å»º Podï¼ˆå‘½ä»¤å¼ï¼‰
kubectl run nginx --image=nginx:latest

# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl describe pod <pod-name>

# æŸ¥çœ‹ Pod æ ‡ç­¾
kubectl get pods --show-labels

# æŒ‰æ ‡ç­¾ç­›é€‰
kubectl get pods -l app=nginx
kubectl get pods -l 'environment in (production,qa)'

# æŸ¥çœ‹ Pod èµ„æºä½¿ç”¨
kubectl top pod <pod-name>
```

**Pod æ—¥å¿—å’Œè°ƒè¯•ï¼š**
```bash
# æŸ¥çœ‹ Pod æ—¥å¿—
kubectl logs <pod-name>

# å®æ—¶è·Ÿè¸ªæ—¥å¿—
kubectl logs -f <pod-name>

# æŸ¥çœ‹å¤šå®¹å™¨ Pod çš„ç‰¹å®šå®¹å™¨æ—¥å¿—
kubectl logs <pod-name> -c <container-name>

# æŸ¥çœ‹ä¹‹å‰çš„æ—¥å¿—ï¼ˆå®¹å™¨å´©æºƒåï¼‰
kubectl logs <pod-name> --previous

# æŸ¥çœ‹æœ€è¿‘çš„æ—¥å¿—
kubectl logs <pod-name> --tail=50

# æŸ¥çœ‹å¸¦æ—¶é—´æˆ³çš„æ—¥å¿—
kubectl logs <pod-name> --timestamps

# è¿›å…¥ Pod æ‰§è¡Œå‘½ä»¤
kubectl exec -it <pod-name> -- /bin/bash
kubectl exec -it <pod-name> -- sh

# åœ¨ Pod ä¸­æ‰§è¡Œå•ä¸ªå‘½ä»¤
kubectl exec <pod-name> -- ls /app

# å¤šå®¹å™¨ Pod æŒ‡å®šå®¹å™¨
kubectl exec -it <pod-name> -c <container-name> -- bash
```

**Pod ç«¯å£è½¬å‘å’Œæ–‡ä»¶å¤åˆ¶ï¼š**
```bash
# ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°è®¿é—® Podï¼‰
kubectl port-forward <pod-name> 8080:80

# ç«¯å£è½¬å‘åˆ°æ‰€æœ‰åœ°å€
kubectl port-forward --address 0.0.0.0 <pod-name> 8080:80

# ä» Pod å¤åˆ¶æ–‡ä»¶åˆ°æœ¬åœ°
kubectl cp <pod-name>:/path/to/file ./local-file

# ä»æœ¬åœ°å¤åˆ¶æ–‡ä»¶åˆ° Pod
kubectl cp ./local-file <pod-name>:/path/to/file

# å¤šå®¹å™¨ Pod æŒ‡å®šå®¹å™¨
kubectl cp <pod-name>:/path/to/file ./local-file -c <container-name>
```

### åœºæ™¯ 3ï¼šDeployment ç®¡ç†

**åˆ›å»ºå’ŒæŸ¥çœ‹ Deploymentï¼š**
```bash
# åˆ›å»º Deployment
kubectl create deployment nginx --image=nginx:latest

# æŒ‡å®šå‰¯æœ¬æ•°
kubectl create deployment nginx --image=nginx:latest --replicas=3

# æŸ¥çœ‹ Deployment
kubectl get deployments
kubectl get deploy

# æŸ¥çœ‹ Deployment è¯¦æƒ…
kubectl describe deployment <deployment-name>

# æŸ¥çœ‹ Deployment YAML
kubectl get deployment <deployment-name> -o yaml

# æŸ¥çœ‹ Deployment çŠ¶æ€
kubectl rollout status deployment/<deployment-name>
```

**æ‰©ç¼©å®¹å’Œæ›´æ–°ï¼š**
```bash
# æ‰©å®¹/ç¼©å®¹
kubectl scale deployment <deployment-name> --replicas=5

# è‡ªåŠ¨æ‰©ç¼©å®¹ï¼ˆHPAï¼‰
kubectl autoscale deployment <deployment-name> --min=2 --max=10 --cpu-percent=80

# æ›´æ–°é•œåƒ
kubectl set image deployment/<deployment-name> <container-name>=nginx:1.21

# ç¼–è¾‘ Deployment
kubectl edit deployment <deployment-name>

# æŸ¥çœ‹æ»šåŠ¨æ›´æ–°å†å²
kubectl rollout history deployment/<deployment-name>

# æŸ¥çœ‹ç‰¹å®šç‰ˆæœ¬è¯¦æƒ…
kubectl rollout history deployment/<deployment-name> --revision=2

# å›æ»šåˆ°ä¸Šä¸€ä¸ªç‰ˆæœ¬
kubectl rollout undo deployment/<deployment-name>

# å›æ»šåˆ°æŒ‡å®šç‰ˆæœ¬
kubectl rollout undo deployment/<deployment-name> --to-revision=2

# æš‚åœæ»šåŠ¨æ›´æ–°
kubectl rollout pause deployment/<deployment-name>

# æ¢å¤æ»šåŠ¨æ›´æ–°
kubectl rollout resume deployment/<deployment-name>

# é‡å¯ Deploymentï¼ˆé‡å»ºæ‰€æœ‰ Podï¼‰
kubectl rollout restart deployment/<deployment-name>
```

### åœºæ™¯ 4ï¼šService å’Œç½‘ç»œ

**åˆ›å»ºå’ŒæŸ¥çœ‹ Serviceï¼š**
```bash
# æš´éœ² Deployment ä¸º Service
kubectl expose deployment nginx --port=80 --type=ClusterIP
kubectl expose deployment nginx --port=80 --type=NodePort
kubectl expose deployment nginx --port=80 --type=LoadBalancer

# æŸ¥çœ‹ Service
kubectl get services
kubectl get svc

# æŸ¥çœ‹ Service è¯¦æƒ…
kubectl describe service <service-name>

# æŸ¥çœ‹ Service çš„ Endpoints
kubectl get endpoints <service-name>
kubectl get ep <service-name>

# åˆ›å»º Serviceï¼ˆYAMLï¼‰
kubectl apply -f - <<EOF
apiVersion: v1
kind: Service
metadata:
  name: my-service
spec:
  selector:
    app: nginx
  ports:
  - protocol: TCP
    port: 80
    targetPort: 8080
  type: ClusterIP
EOF
```

**ç½‘ç»œè°ƒè¯•ï¼š**
```bash
# åœ¨é›†ç¾¤å†…éƒ¨æµ‹è¯• Service è¿æ¥
kubectl run -it --rm debug --image=busybox --restart=Never -- sh
# ç„¶ååœ¨ Pod ä¸­ï¼š
wget -O- http://my-service

# ä½¿ç”¨ curl é•œåƒæµ‹è¯•
kubectl run -it --rm debug --image=curlimages/curl --restart=Never -- sh

# æŸ¥çœ‹ DNS è®°å½•
kubectl run -it --rm debug --image=busybox --restart=Never -- nslookup my-service

# æµ‹è¯•ç‰¹å®šå‘½åç©ºé—´çš„ Service
nslookup my-service.default.svc.cluster.local
```

### åœºæ™¯ 5ï¼šConfigMap å’Œ Secret

**ConfigMap ç®¡ç†ï¼š**
```bash
# ä»å­—é¢å€¼åˆ›å»º ConfigMap
kubectl create configmap my-config --from-literal=key1=value1 --from-literal=key2=value2

# ä»æ–‡ä»¶åˆ›å»º ConfigMap
kubectl create configmap my-config --from-file=config.properties

# ä»ç›®å½•åˆ›å»º ConfigMap
kubectl create configmap my-config --from-file=./config-dir/

# æŸ¥çœ‹ ConfigMap
kubectl get configmaps
kubectl get cm

# æŸ¥çœ‹ ConfigMap å†…å®¹
kubectl describe configmap my-config
kubectl get configmap my-config -o yaml

# ç¼–è¾‘ ConfigMap
kubectl edit configmap my-config
```

**Secret ç®¡ç†ï¼š**
```bash
# ä»å­—é¢å€¼åˆ›å»º Secret
kubectl create secret generic my-secret --from-literal=password=supersecret

# ä»æ–‡ä»¶åˆ›å»º Secret
kubectl create secret generic my-secret --from-file=ssh-privatekey=~/.ssh/id_rsa

# åˆ›å»º Docker é•œåƒä»“åº“ Secret
kubectl create secret docker-registry regcred \
  --docker-server=https://index.docker.io/v1/ \
  --docker-username=myuser \
  --docker-password=mypassword \
  --docker-email=myemail@example.com

# åˆ›å»º TLS Secret
kubectl create secret tls my-tls-secret \
  --cert=path/to/tls.crt \
  --key=path/to/tls.key

# æŸ¥çœ‹ Secretï¼ˆä¸æ˜¾ç¤ºå†…å®¹ï¼‰
kubectl get secrets

# æŸ¥çœ‹ Secret å†…å®¹ï¼ˆBase64 ç¼–ç ï¼‰
kubectl get secret my-secret -o yaml

# è§£ç  Secret
kubectl get secret my-secret -o jsonpath='{.data.password}' | base64 --decode
```

### åœºæ™¯ 6ï¼šæŒä¹…åŒ–å­˜å‚¨

**PersistentVolume å’Œ PersistentVolumeClaimï¼š**
```bash
# æŸ¥çœ‹ PV
kubectl get pv

# æŸ¥çœ‹ PVC
kubectl get pvc

# æŸ¥çœ‹ StorageClass
kubectl get storageclass
kubectl get sc

# åˆ›å»º PVCï¼ˆYAMLï¼‰
kubectl apply -f - <<EOF
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: my-pvc
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 10Gi
  storageClassName: standard
EOF

# æŸ¥çœ‹ PVC ç»‘å®šçŠ¶æ€
kubectl describe pvc my-pvc
```

### åœºæ™¯ 7ï¼šèµ„æºç®¡ç†å’Œæ¸…ç†

**åˆ é™¤èµ„æºï¼š**
```bash
# åˆ é™¤ Pod
kubectl delete pod <pod-name>

# å¼ºåˆ¶åˆ é™¤ Podï¼ˆå¡ä½æ—¶ï¼‰
kubectl delete pod <pod-name> --force --grace-period=0

# åˆ é™¤ Deployment
kubectl delete deployment <deployment-name>

# åˆ é™¤ Service
kubectl delete service <service-name>

# æŒ‰æ ‡ç­¾åˆ é™¤
kubectl delete pods -l app=nginx

# åˆ é™¤å‘½åç©ºé—´ï¼ˆä¼šåˆ é™¤å…¶ä¸‹æ‰€æœ‰èµ„æºï¼‰
kubectl delete namespace dev

# åˆ é™¤æ‰€æœ‰ Pod
kubectl delete pods --all

# åˆ é™¤é…ç½®æ–‡ä»¶ä¸­å®šä¹‰çš„èµ„æº
kubectl delete -f deployment.yaml

# æ‰¹é‡åˆ é™¤èµ„æº
kubectl delete deploy,svc,cm,secret -l app=myapp
```

**èµ„æºæŸ¥çœ‹å’Œå¯¼å‡ºï¼š**
```bash
# å¯¼å‡ºèµ„æº YAML
kubectl get deployment nginx -o yaml > deployment.yaml

# å¯¼å‡ºèµ„æº JSON
kubectl get deployment nginx -o json > deployment.json

# åªå¯¼å‡ºèµ„æºå®šä¹‰ï¼ˆå»é™¤è¿è¡Œæ—¶å­—æ®µï¼‰
kubectl get deployment nginx -o yaml --export > deployment.yaml

# æŸ¥çœ‹æ‰€æœ‰èµ„æº
kubectl get all

# æŸ¥çœ‹ç‰¹å®šå‘½åç©ºé—´çš„æ‰€æœ‰èµ„æº
kubectl get all -n kube-system

# æŸ¥çœ‹é›†ç¾¤æ‰€æœ‰èµ„æº
kubectl get all --all-namespaces
kubectl get all -A
```

### åœºæ™¯ 8ï¼šæ•…éšœè¯Šæ–­

**Pod é—®é¢˜è¯Šæ–­ï¼š**
```bash
# æŸ¥çœ‹ Pod äº‹ä»¶
kubectl describe pod <pod-name>

# æŸ¥çœ‹æ‰€æœ‰äº‹ä»¶
kubectl get events --sort-by='.lastTimestamp'

# æŸ¥çœ‹ç‰¹å®šèµ„æºçš„äº‹ä»¶
kubectl get events --field-selector involvedObject.name=<pod-name>

# æŸ¥çœ‹ Pod çŠ¶æ€åŸå› 
kubectl get pod <pod-name> -o jsonpath='{.status.conditions[?(@.type=="Ready")].message}'

# æŸ¥çœ‹å®¹å™¨é€€å‡ºåŸå› 
kubectl get pod <pod-name> -o jsonpath='{.status.containerStatuses[0].state.terminated.reason}'
```

**å¸¸è§é—®é¢˜ï¼š**

**ImagePullBackOffï¼š**
```bash
# æ£€æŸ¥é•œåƒåç§°æ˜¯å¦æ­£ç¡®
kubectl describe pod <pod-name> | grep Image

# æ£€æŸ¥æ˜¯å¦éœ€è¦ç§æœ‰ä»“åº“è®¤è¯
kubectl get secret regcred -o yaml

# å¦‚æœæ˜¯ç§æœ‰ä»“åº“ï¼ŒPod éœ€è¦å¼•ç”¨ Secret
# spec.imagePullSecrets:
#   - name: regcred
```

**CrashLoopBackOffï¼š**
```bash
# æŸ¥çœ‹å®¹å™¨æ—¥å¿—
kubectl logs <pod-name> --previous

# æŸ¥çœ‹ Pod è¯¦æƒ…
kubectl describe pod <pod-name>

# å¯èƒ½åŸå› ï¼š
# - åº”ç”¨å´©æºƒï¼ˆæ£€æŸ¥æ—¥å¿—ï¼‰
# - å¥åº·æ£€æŸ¥å¤±è´¥ï¼ˆæ£€æŸ¥ liveness probeï¼‰
# - èµ„æºä¸è¶³ï¼ˆæ£€æŸ¥ requests/limitsï¼‰
```

**Pending çŠ¶æ€ï¼š**
```bash
# æŸ¥çœ‹è°ƒåº¦å¤±è´¥åŸå› 
kubectl describe pod <pod-name>

# å¸¸è§åŸå› ï¼š
# - èµ„æºä¸è¶³ï¼ˆInsufficient cpu/memoryï¼‰
# - èŠ‚ç‚¹é€‰æ‹©å™¨ä¸åŒ¹é…ï¼ˆnode selector doesn't matchï¼‰
# - PVC æ— æ³•ç»‘å®šï¼ˆPVC not boundï¼‰
# - èŠ‚ç‚¹æ±¡ç‚¹ï¼ˆTaintsï¼‰
```

## é«˜çº§æŠ€å·§

### 1. JSONPath æŸ¥è¯¢

```bash
# è·å–æ‰€æœ‰ Pod çš„ IP
kubectl get pods -o jsonpath='{.items[*].status.podIP}'

# è·å–æ‰€æœ‰ Pod åç§°
kubectl get pods -o jsonpath='{.items[*].metadata.name}'

# è·å–ç‰¹å®šå­—æ®µå¹¶æ ¼å¼åŒ–
kubectl get pods -o jsonpath='{range .items[*]}{.metadata.name}{"\t"}{.status.podIP}{"\n"}{end}'

# è·å–å®¹å™¨é•œåƒ
kubectl get pods -o jsonpath='{.items[*].spec.containers[*].image}'
```

### 2. åˆ«åå’Œå¿«æ·æ–¹å¼

```bash
# æ·»åŠ åˆ° ~/.bashrc æˆ– ~/.zshrc

# å¸¸ç”¨å‘½ä»¤åˆ«å
alias k='kubectl'
alias kgp='kubectl get pods'
alias kgd='kubectl get deployments'
alias kgs='kubectl get services'
alias kga='kubectl get all'
alias kd='kubectl describe'
alias kdp='kubectl describe pod'
alias kl='kubectl logs'
alias klf='kubectl logs -f'
alias kex='kubectl exec -it'

# åˆ‡æ¢å‘½åç©ºé—´
alias kns='kubectl config set-context --current --namespace'

# æŸ¥çœ‹æ‰€æœ‰å‘½åç©ºé—´
alias kgns='kubectl get namespaces'
```

### 3. èµ„æºç®€å†™

```bash
pods           â†’ po
deployments    â†’ deploy
services       â†’ svc
namespaces     â†’ ns
nodes          â†’ no
configmaps     â†’ cm
secrets        â†’ (æ— ç®€å†™)
persistentvolumeclaims â†’ pvc
persistentvolumes â†’ pv
storageclass   â†’ sc
ingress        â†’ ing

# ç¤ºä¾‹
kubectl get po
kubectl get deploy
kubectl get svc
```

### 4. æ‰¹é‡æ“ä½œ

```bash
# é‡å¯æ‰€æœ‰åŒ¹é…æ ‡ç­¾çš„ Pod
kubectl delete pods -l app=nginx

# æ‰¹é‡æŸ¥çœ‹æ—¥å¿—
for pod in $(kubectl get pods -l app=nginx -o name); do
  echo "=== $pod ==="
  kubectl logs $pod --tail=10
done

# æ‰¹é‡ç«¯å£è½¬å‘ï¼ˆä½¿ç”¨ tmuxï¼‰
kubectl get pods -l app=nginx -o name | while read pod; do
  tmux new-window "kubectl port-forward $pod 8080:80"
done
```

## è”ç½‘æŸ¥è¯¢æœ€æ–°ç”¨æ³•

**æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼š**
```bash
# ä½¿ç”¨ ai-query æŸ¥è¯¢
ai-query expert kubectl

# è®¿é—®å®˜æ–¹æ–‡æ¡£
open https://kubernetes.io/docs/reference/kubectl/
```

**å¸¸ç”¨æ–‡æ¡£é“¾æ¥ï¼š**
- kubectl é€ŸæŸ¥è¡¨ï¼šhttps://kubernetes.io/docs/reference/kubectl/cheatsheet/
- kubectl å‘½ä»¤å‚è€ƒï¼šhttps://kubernetes.io/docs/reference/generated/kubectl/kubectl-commands
- æ¦‚å¿µæ–‡æ¡£ï¼šhttps://kubernetes.io/docs/concepts/

## å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå‘½ä»¤æ‰§è¡Œè¶…æ—¶æˆ–æŒ‚èµ·

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥é›†ç¾¤è¿æ¥
kubectl cluster-info

# æ£€æŸ¥ API Server æ˜¯å¦å¯è¾¾
kubectl get --raw /healthz

# å¢åŠ è¶…æ—¶æ—¶é—´
kubectl get pods --request-timeout=30s

# æ£€æŸ¥ kubeconfig
kubectl config view
```

### é—®é¢˜ 2ï¼šæƒé™ä¸è¶³

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥å½“å‰ç”¨æˆ·æƒé™
kubectl auth can-i get pods
kubectl auth can-i create deployments

# æŸ¥çœ‹å½“å‰ç”¨æˆ·
kubectl config view --minify

# æŸ¥çœ‹ ServiceAccount
kubectl get serviceaccounts

# æŸ¥çœ‹ RBAC è§’è‰²
kubectl get roles
kubectl get clusterroles
```

### é—®é¢˜ 3ï¼šèµ„æºé…é¢é™åˆ¶

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æŸ¥çœ‹å‘½åç©ºé—´èµ„æºé…é¢
kubectl get resourcequotas
kubectl describe resourcequota

# æŸ¥çœ‹èµ„æºä½¿ç”¨æƒ…å†µ
kubectl describe namespace <namespace>

# æŸ¥çœ‹ LimitRange
kubectl get limitranges
kubectl describe limitrange
```

## äº¤äº’æ–¹å¼

### å“åº”æ¨¡æ¿

```
âœ… ç†è§£ï¼š[ç”¨æˆ·éœ€æ±‚]

ğŸ“‹ å½“å‰çŠ¶æ€æ£€æŸ¥ï¼š
[å»ºè®®å…ˆè¿è¡Œçš„æ£€æŸ¥å‘½ä»¤]

ğŸ”§ æ¨èæ–¹æ¡ˆï¼š
[å…·ä½“çš„ kubectl å‘½ä»¤]

ğŸ’¡ å‘½ä»¤è¯´æ˜ï¼š
[è§£é‡Šå„å‚æ•°ä½œç”¨]

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
[é£é™©æç¤ºå’Œæ³¨æ„ç‚¹]

ğŸ“– è¿›é˜¶ï¼š
[ç›¸å…³çš„é«˜çº§ç”¨æ³•]
```

## ç¤ºä¾‹å¯¹è¯

**ç”¨æˆ·**ï¼šæˆ‘çš„ Pod ä¸€ç›´å¤„äº Pending çŠ¶æ€ï¼Œæ€ä¹ˆåŠï¼Ÿ

**ä½ **ï¼š
âœ… ç†è§£ï¼šPod æ— æ³•è¢«è°ƒåº¦åˆ°èŠ‚ç‚¹

ğŸ“‹ è¯Šæ–­æ­¥éª¤ï¼š
```bash
# 1. æŸ¥çœ‹ Pod è¯¦æƒ…ï¼Œæ‰¾åˆ°è°ƒåº¦å¤±è´¥åŸå› 
kubectl describe pod <pod-name>

# é‡ç‚¹å…³æ³¨ Events éƒ¨åˆ†ï¼Œå¸¸è§åŸå› ï¼š
# - Insufficient cpu/memory
# - No nodes available
# - PVC not bound
```

ğŸ”§ æ ¹æ®åŸå› è§£å†³ï¼š

**åŸå›  1ï¼šèµ„æºä¸è¶³**
```bash
# æŸ¥çœ‹èŠ‚ç‚¹èµ„æº
kubectl top nodes

# é™ä½ Pod èµ„æºè¯·æ±‚æˆ–æ‰©å®¹èŠ‚ç‚¹
kubectl scale deployment <name> --replicas=0  # æš‚æ—¶ç¼©å®¹
kubectl get pod <pod-name> -o yaml | less     # æ£€æŸ¥ requests
```

**åŸå›  2ï¼šPVC æœªç»‘å®š**
```bash
# æŸ¥çœ‹ PVC çŠ¶æ€
kubectl get pvc

# åˆ›å»º PV æˆ–ä¿®å¤ StorageClass
kubectl get storageclass
```

**åŸå›  3ï¼šèŠ‚ç‚¹é€‰æ‹©å™¨ä¸åŒ¹é…**
```bash
# æŸ¥çœ‹ Pod çš„èŠ‚ç‚¹é€‰æ‹©å™¨
kubectl get pod <pod-name> -o yaml | grep -A5 nodeSelector

# æŸ¥çœ‹èŠ‚ç‚¹æ ‡ç­¾
kubectl get nodes --show-labels

# å¦‚æœä¸åŒ¹é…ï¼Œä¿®æ”¹ Pod æˆ–ç»™èŠ‚ç‚¹æ‰“æ ‡ç­¾
kubectl label nodes <node-name> disktype=ssd
```

âš ï¸ æ³¨æ„ï¼š
- å…ˆå¤‡ä»½é…ç½®ï¼š`kubectl get pod <pod-name> -o yaml > backup.yaml`
- åˆ é™¤ Pod å‰ç¡®è®¤ä¸ä¼šå½±å“æœåŠ¡

---

ç°åœ¨ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆ Kubernetes æ“ä½œå¸®åŠ©ï¼
