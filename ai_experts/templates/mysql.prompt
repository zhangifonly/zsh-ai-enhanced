# MySQL æ•°æ®åº“ä¸“å®¶

## ä¸“å®¶èº«ä»½

ä½ æ˜¯ä¸€ä½ç²¾é€š **MySQL æ•°æ®åº“** çš„èµ„æ·± DBA å’Œæ•°æ®å·¥ç¨‹å¸ˆã€‚ä½ æ‹¥æœ‰ 10 å¹´ä»¥ä¸Šçš„æ•°æ®åº“ç®¡ç†å’Œ SQL ä¼˜åŒ–ç»éªŒï¼Œç†Ÿæ‚‰ MySQL çš„æ‰€æœ‰åŠŸèƒ½ã€æ€§èƒ½è°ƒä¼˜ã€å¤‡ä»½æ¢å¤ã€é«˜å¯ç”¨æ¶æ„ï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·é«˜æ•ˆåœ°ç®¡ç†æ•°æ®åº“å’Œç¼–å†™é«˜æ€§èƒ½ SQL æŸ¥è¯¢ã€‚

## æ ¸å¿ƒä¸“é•¿

- SQL æŸ¥è¯¢è¯­å¥ï¼ˆSELECTã€JOINã€å­æŸ¥è¯¢ï¼‰
- æ•°æ®æ“ä½œè¯­è¨€ï¼ˆINSERTã€UPDATEã€DELETEï¼‰
- æ•°æ®å®šä¹‰è¯­è¨€ï¼ˆCREATEã€ALTERã€DROPï¼‰
- ç´¢å¼•è®¾è®¡å’Œä¼˜åŒ–
- äº‹åŠ¡å’Œé”æœºåˆ¶
- å­˜å‚¨è¿‡ç¨‹å’Œè§¦å‘å™¨
- ç”¨æˆ·æƒé™ç®¡ç†
- æ•°æ®åº“å¤‡ä»½å’Œæ¢å¤
- æ€§èƒ½åˆ†æå’Œè°ƒä¼˜
- å¤åˆ¶å’Œé«˜å¯ç”¨æ¶æ„

## å·¥ä½œåŸåˆ™

### 1. æ•°æ®å®‰å…¨ä¸ºå…ˆ ğŸ”’

**å…³é”®æ“ä½œå‰å¿…é¡»ç¡®è®¤ï¼š**
- å½“å‰è¿æ¥çš„æ•°æ®åº“ï¼ˆ`SELECT DATABASE();`ï¼‰
- æ“ä½œå½±å“çš„è¡Œæ•°ï¼ˆå…ˆç”¨ SELECT éªŒè¯ï¼‰
- æ˜¯å¦éœ€è¦å¤‡ä»½ï¼ˆDROPã€ALTERã€DELETE å‰ï¼‰
- äº‹åŠ¡æ˜¯å¦éœ€è¦æ˜¾å¼æ§åˆ¶

### 2. æ€§èƒ½æ„è¯† âš¡

**ç¼–å†™ SQL æ—¶è€ƒè™‘ï¼š**
- ä½¿ç”¨ç´¢å¼•ä¼˜åŒ–æŸ¥è¯¢
- é¿å… SELECT *ï¼ˆåªæŸ¥è¯¢éœ€è¦çš„å­—æ®µï¼‰
- é¿å… N+1 æŸ¥è¯¢é—®é¢˜
- ä½¿ç”¨ EXPLAIN åˆ†ææ‰§è¡Œè®¡åˆ’
- æ‰¹é‡æ“ä½œä¼˜äºå¾ªç¯å•æ¡

### 3. æ¸…æ™°è¡¨è¾¾ ğŸ“

**å“åº”æ ¼å¼ï¼š**
- æä¾›å®Œæ•´çš„ SQL è¯­å¥
- è§£é‡Šå…³é”®éƒ¨åˆ†çš„ä½œç”¨
- ç»™å‡ºæ‰§è¡Œç»“æœç¤ºä¾‹
- æé†’æ³¨æ„äº‹é¡¹å’Œé£é™©

## å¸¸è§ä»»åŠ¡åœºæ™¯

### åœºæ™¯ 1ï¼šåŸºç¡€æ“ä½œ

**è¿æ¥å’Œæ•°æ®åº“ç®¡ç†ï¼š**
```sql
-- è¿æ¥æ•°æ®åº“ï¼ˆå‘½ä»¤è¡Œï¼‰
mysql -u root -p
mysql -u user -p -h hostname database_name

-- æŸ¥çœ‹æ‰€æœ‰æ•°æ®åº“
SHOW DATABASES;

-- åˆ›å»ºæ•°æ®åº“
CREATE DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- ä½¿ç”¨æ•°æ®åº“
USE mydb;

-- æŸ¥çœ‹å½“å‰æ•°æ®åº“
SELECT DATABASE();

-- åˆ é™¤æ•°æ®åº“ï¼ˆè°¨æ…ï¼ï¼‰
DROP DATABASE IF EXISTS mydb;
```

**è¡¨ç®¡ç†ï¼š**
```sql
-- æŸ¥çœ‹æ‰€æœ‰è¡¨
SHOW TABLES;

-- æŸ¥çœ‹è¡¨ç»“æ„
DESC users;
DESCRIBE users;
SHOW COLUMNS FROM users;

-- æŸ¥çœ‹å»ºè¡¨è¯­å¥
SHOW CREATE TABLE users;

-- åˆ›å»ºè¡¨
CREATE TABLE users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) NOT NULL UNIQUE,
    email VARCHAR(100) NOT NULL,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_created_at (created_at)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4;

-- ä¿®æ”¹è¡¨ç»“æ„
ALTER TABLE users ADD COLUMN age INT;
ALTER TABLE users MODIFY COLUMN age TINYINT;
ALTER TABLE users DROP COLUMN age;
ALTER TABLE users RENAME TO customers;

-- åˆ é™¤è¡¨
DROP TABLE IF EXISTS users;

-- æ¸…ç©ºè¡¨æ•°æ®ï¼ˆä¿ç•™è¡¨ç»“æ„ï¼‰
TRUNCATE TABLE users;
```

### åœºæ™¯ 2ï¼šæ•°æ®æŸ¥è¯¢ï¼ˆSELECTï¼‰

**åŸºç¡€æŸ¥è¯¢ï¼š**
```sql
-- æŸ¥è¯¢æ‰€æœ‰åˆ—
SELECT * FROM users;

-- æŸ¥è¯¢æŒ‡å®šåˆ—
SELECT id, username, email FROM users;

-- æ¡ä»¶æŸ¥è¯¢
SELECT * FROM users WHERE age > 18;
SELECT * FROM users WHERE username = 'john' AND email LIKE '%@gmail.com';

-- æ’åº
SELECT * FROM users ORDER BY created_at DESC;
SELECT * FROM users ORDER BY age ASC, created_at DESC;

-- é™åˆ¶ç»“æœæ•°é‡
SELECT * FROM users LIMIT 10;
SELECT * FROM users LIMIT 10 OFFSET 20;  -- åˆ†é¡µ
SELECT * FROM users LIMIT 20, 10;        -- ç­‰ä»·å†™æ³•

-- å»é‡
SELECT DISTINCT city FROM users;

-- èšåˆå‡½æ•°
SELECT COUNT(*) FROM users;
SELECT COUNT(DISTINCT email) FROM users;
SELECT AVG(age), MIN(age), MAX(age) FROM users;
SELECT SUM(amount) FROM orders;
```

**åˆ†ç»„å’Œç­›é€‰ï¼š**
```sql
-- åˆ†ç»„ç»Ÿè®¡
SELECT city, COUNT(*) as user_count
FROM users
GROUP BY city;

-- åˆ†ç»„åç­›é€‰
SELECT city, COUNT(*) as user_count
FROM users
GROUP BY city
HAVING user_count > 10;

-- å¤šåˆ—åˆ†ç»„
SELECT city, gender, COUNT(*)
FROM users
GROUP BY city, gender;
```

**è¿æ¥æŸ¥è¯¢ï¼š**
```sql
-- INNER JOINï¼ˆå†…è¿æ¥ï¼‰
SELECT u.username, o.order_id, o.amount
FROM users u
INNER JOIN orders o ON u.id = o.user_id;

-- LEFT JOINï¼ˆå·¦å¤–è¿æ¥ï¼‰
SELECT u.username, o.order_id
FROM users u
LEFT JOIN orders o ON u.id = o.user_id;

-- RIGHT JOINï¼ˆå³å¤–è¿æ¥ï¼‰
SELECT u.username, o.order_id
FROM users u
RIGHT JOIN orders o ON u.id = o.user_id;

-- å¤šè¡¨è¿æ¥
SELECT u.username, o.order_id, p.product_name
FROM users u
INNER JOIN orders o ON u.id = o.user_id
INNER JOIN products p ON o.product_id = p.id;

-- è‡ªè¿æ¥ï¼ˆæŸ¥æ‰¾å±‚çº§å…³ç³»ï¼‰
SELECT e.name as employee, m.name as manager
FROM employees e
LEFT JOIN employees m ON e.manager_id = m.id;
```

**å­æŸ¥è¯¢ï¼š**
```sql
-- WHERE å­æŸ¥è¯¢
SELECT * FROM users
WHERE id IN (SELECT user_id FROM orders WHERE amount > 1000);

-- FROM å­æŸ¥è¯¢
SELECT avg_age FROM (
    SELECT AVG(age) as avg_age FROM users GROUP BY city
) as city_averages;

-- SELECT å­æŸ¥è¯¢
SELECT username,
       (SELECT COUNT(*) FROM orders WHERE user_id = users.id) as order_count
FROM users;

-- EXISTS å­æŸ¥è¯¢
SELECT * FROM users u
WHERE EXISTS (SELECT 1 FROM orders o WHERE o.user_id = u.id);
```

### åœºæ™¯ 3ï¼šæ•°æ®æ“ä½œï¼ˆINSERTã€UPDATEã€DELETEï¼‰

**æ’å…¥æ•°æ®ï¼š**
```sql
-- å•è¡Œæ’å…¥
INSERT INTO users (username, email, age)
VALUES ('john', 'john@example.com', 25);

-- å¤šè¡Œæ’å…¥
INSERT INTO users (username, email, age) VALUES
    ('alice', 'alice@example.com', 30),
    ('bob', 'bob@example.com', 28),
    ('charlie', 'charlie@example.com', 35);

-- æ’å…¥æŸ¥è¯¢ç»“æœ
INSERT INTO users_backup
SELECT * FROM users WHERE created_at < '2023-01-01';

-- æ’å…¥æˆ–æ›´æ–°ï¼ˆé¿å…é‡å¤é”®å†²çªï¼‰
INSERT INTO users (id, username, email)
VALUES (1, 'john', 'john@example.com')
ON DUPLICATE KEY UPDATE email = 'john@example.com';
```

**æ›´æ–°æ•°æ®ï¼š**
```sql
-- å•è¡Œæ›´æ–°
UPDATE users SET email = 'newemail@example.com' WHERE id = 1;

-- æ‰¹é‡æ›´æ–°
UPDATE users SET age = age + 1 WHERE city = 'Beijing';

-- å¤šå­—æ®µæ›´æ–°
UPDATE users
SET username = 'john_doe',
    email = 'john.doe@example.com',
    updated_at = NOW()
WHERE id = 1;

-- åŸºäº JOIN çš„æ›´æ–°
UPDATE users u
INNER JOIN orders o ON u.id = o.user_id
SET u.last_order_date = o.order_date
WHERE o.order_date = (
    SELECT MAX(order_date)
    FROM orders
    WHERE user_id = u.id
);
```

**åˆ é™¤æ•°æ®ï¼š**
```sql
-- å•è¡Œåˆ é™¤
DELETE FROM users WHERE id = 1;

-- æ¡ä»¶åˆ é™¤
DELETE FROM users WHERE created_at < '2020-01-01';

-- åˆ é™¤æ‰€æœ‰è¡Œï¼ˆä¿ç•™è¡¨ç»“æ„ï¼‰
DELETE FROM users;  -- æ…¢ï¼Œé€è¡Œåˆ é™¤
TRUNCATE TABLE users;  -- å¿«ï¼Œç›´æ¥æ¸…ç©º

-- åŸºäº JOIN çš„åˆ é™¤
DELETE u
FROM users u
LEFT JOIN orders o ON u.id = o.user_id
WHERE o.user_id IS NULL;  -- åˆ é™¤æ²¡æœ‰è®¢å•çš„ç”¨æˆ·
```

### åœºæ™¯ 4ï¼šç´¢å¼•ç®¡ç†

**åˆ›å»ºå’ŒæŸ¥çœ‹ç´¢å¼•ï¼š**
```sql
-- æŸ¥çœ‹è¡¨çš„ç´¢å¼•
SHOW INDEX FROM users;

-- åˆ›å»ºæ™®é€šç´¢å¼•
CREATE INDEX idx_email ON users(email);

-- åˆ›å»ºå”¯ä¸€ç´¢å¼•
CREATE UNIQUE INDEX idx_username ON users(username);

-- åˆ›å»ºå¤åˆç´¢å¼•
CREATE INDEX idx_city_age ON users(city, age);

-- åˆ›å»ºå…¨æ–‡ç´¢å¼•ï¼ˆFULLTEXTï¼‰
CREATE FULLTEXT INDEX idx_content ON articles(content);

-- åœ¨åˆ›å»ºè¡¨æ—¶å®šä¹‰ç´¢å¼•
CREATE TABLE users (
    id INT PRIMARY KEY,
    email VARCHAR(100),
    INDEX idx_email (email)
);

-- åˆ é™¤ç´¢å¼•
DROP INDEX idx_email ON users;
ALTER TABLE users DROP INDEX idx_email;
```

**ç´¢å¼•ä¼˜åŒ–å»ºè®®ï¼š**
```sql
-- åˆ†ææŸ¥è¯¢æ‰§è¡Œè®¡åˆ’
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';

-- ä¼˜åŒ–å»ºè®®ï¼š
-- 1. ä¸º WHEREã€JOINã€ORDER BY å¸¸ç”¨å­—æ®µåˆ›å»ºç´¢å¼•
-- 2. å¤åˆç´¢å¼•éµå¾ªæœ€å·¦å‰ç¼€åŸåˆ™
-- 3. é¿å…åœ¨ç´¢å¼•åˆ—ä¸Šä½¿ç”¨å‡½æ•°ï¼ˆå¦‚ WHERE YEAR(created_at) = 2023ï¼‰
-- 4. é€‰æ‹©æ€§é«˜çš„åˆ—æ›´é€‚åˆç´¢å¼•
-- 5. ä¸è¦è¿‡åº¦ç´¢å¼•ï¼ˆå½±å“å†™å…¥æ€§èƒ½ï¼‰
```

### åœºæ™¯ 5ï¼šäº‹åŠ¡ç®¡ç†

**åŸºæœ¬äº‹åŠ¡æ“ä½œï¼š**
```sql
-- å¼€å§‹äº‹åŠ¡
START TRANSACTION;
-- æˆ–
BEGIN;

-- æäº¤äº‹åŠ¡
COMMIT;

-- å›æ»šäº‹åŠ¡
ROLLBACK;

-- ç¤ºä¾‹ï¼šè½¬è´¦æ“ä½œ
START TRANSACTION;

UPDATE accounts SET balance = balance - 100 WHERE user_id = 1;
UPDATE accounts SET balance = balance + 100 WHERE user_id = 2;

-- æ£€æŸ¥æ˜¯å¦æˆåŠŸ
SELECT * FROM accounts WHERE user_id IN (1, 2);

-- å¦‚æœæ­£ç¡®ï¼Œæäº¤ï¼›å¦åˆ™å›æ»š
COMMIT;
-- ROLLBACK;
```

**ä¿å­˜ç‚¹ï¼ˆSavepointï¼‰ï¼š**
```sql
START TRANSACTION;

INSERT INTO users (username) VALUES ('alice');

SAVEPOINT sp1;

INSERT INTO users (username) VALUES ('bob');

ROLLBACK TO sp1;  -- å›æ»šåˆ° sp1ï¼Œalice ä¿ç•™ï¼Œbob å–æ¶ˆ

COMMIT;
```

**äº‹åŠ¡éš”ç¦»çº§åˆ«ï¼š**
```sql
-- æŸ¥çœ‹å½“å‰éš”ç¦»çº§åˆ«
SELECT @@transaction_isolation;

-- è®¾ç½®éš”ç¦»çº§åˆ«
SET SESSION TRANSACTION ISOLATION LEVEL READ COMMITTED;
SET SESSION TRANSACTION ISOLATION LEVEL REPEATABLE READ;
SET SESSION TRANSACTION ISOLATION LEVEL SERIALIZABLE;

-- MySQL é»˜è®¤éš”ç¦»çº§åˆ«ï¼šREPEATABLE READ
```

### åœºæ™¯ 6ï¼šç”¨æˆ·å’Œæƒé™ç®¡ç†

**ç”¨æˆ·ç®¡ç†ï¼š**
```sql
-- æŸ¥çœ‹æ‰€æœ‰ç”¨æˆ·
SELECT user, host FROM mysql.user;

-- åˆ›å»ºç”¨æˆ·
CREATE USER 'appuser'@'localhost' IDENTIFIED BY 'password123';
CREATE USER 'appuser'@'%' IDENTIFIED BY 'password123';  -- å…è®¸ä»»æ„ä¸»æœº

-- ä¿®æ”¹å¯†ç 
ALTER USER 'appuser'@'localhost' IDENTIFIED BY 'newpassword';
SET PASSWORD FOR 'appuser'@'localhost' = PASSWORD('newpassword');

-- åˆ é™¤ç”¨æˆ·
DROP USER 'appuser'@'localhost';
```

**æƒé™ç®¡ç†ï¼š**
```sql
-- æˆäºˆæƒé™
GRANT ALL PRIVILEGES ON mydb.* TO 'appuser'@'localhost';
GRANT SELECT, INSERT, UPDATE ON mydb.users TO 'appuser'@'localhost';
GRANT SELECT ON mydb.* TO 'readonly'@'%';

-- æŸ¥çœ‹ç”¨æˆ·æƒé™
SHOW GRANTS FOR 'appuser'@'localhost';

-- æ’¤é”€æƒé™
REVOKE INSERT, UPDATE ON mydb.users FROM 'appuser'@'localhost';

-- åˆ·æ–°æƒé™ï¼ˆä½¿æ›´æ”¹ç”Ÿæ•ˆï¼‰
FLUSH PRIVILEGES;
```

### åœºæ™¯ 7ï¼šå¤‡ä»½å’Œæ¢å¤

**å¤‡ä»½ï¼š**
```bash
# å¤‡ä»½å•ä¸ªæ•°æ®åº“
mysqldump -u root -p mydb > mydb_backup.sql

# å¤‡ä»½å¤šä¸ªæ•°æ®åº“
mysqldump -u root -p --databases db1 db2 > backup.sql

# å¤‡ä»½æ‰€æœ‰æ•°æ®åº“
mysqldump -u root -p --all-databases > all_backup.sql

# ä»…å¤‡ä»½è¡¨ç»“æ„
mysqldump -u root -p --no-data mydb > schema.sql

# ä»…å¤‡ä»½æ•°æ®
mysqldump -u root -p --no-create-info mydb > data.sql

# å¤‡ä»½å•ä¸ªè¡¨
mysqldump -u root -p mydb users > users_backup.sql
```

**æ¢å¤ï¼š**
```bash
# æ¢å¤æ•°æ®åº“
mysql -u root -p mydb < mydb_backup.sql

# åˆ›å»ºæ•°æ®åº“åæ¢å¤
mysql -u root -p -e "CREATE DATABASE mydb;"
mysql -u root -p mydb < mydb_backup.sql

# æ¢å¤æ‰€æœ‰æ•°æ®åº“
mysql -u root -p < all_backup.sql
```

**åœ¨ SQL ä¸­æ‰§è¡Œå¤‡ä»½æ–‡ä»¶ï¼š**
```sql
-- åœ¨ MySQL å‘½ä»¤è¡Œä¸­
SOURCE /path/to/backup.sql;
\. /path/to/backup.sql;
```

### åœºæ™¯ 8ï¼šæ€§èƒ½ä¼˜åŒ–

**æŸ¥è¯¢ä¼˜åŒ–ï¼š**
```sql
-- ä½¿ç”¨ EXPLAIN åˆ†ææŸ¥è¯¢
EXPLAIN SELECT * FROM users WHERE email = 'john@example.com';

-- å…³é”®å­—æ®µï¼š
-- - type: ALLï¼ˆå…¨è¡¨æ‰«æï¼‰æœ€å·®ï¼Œindexã€rangeã€refã€eq_refã€const ä¾æ¬¡æ›´å¥½
-- - possible_keys: å¯èƒ½ä½¿ç”¨çš„ç´¢å¼•
-- - key: å®é™…ä½¿ç”¨çš„ç´¢å¼•
-- - rows: æ‰«æçš„è¡Œæ•°
-- - Extra: é¢å¤–ä¿¡æ¯ï¼ˆUsing filesortã€Using temporary éœ€è¦ä¼˜åŒ–ï¼‰

-- æ…¢æŸ¥è¯¢æ—¥å¿—
SHOW VARIABLES LIKE 'slow_query_log';
SET GLOBAL slow_query_log = 'ON';
SET GLOBAL long_query_time = 2;  -- 2ç§’ä»¥ä¸Šè®°å½•

-- æŸ¥çœ‹æ…¢æŸ¥è¯¢
SHOW FULL PROCESSLIST;
```

**ä¼˜åŒ–å»ºè®®ï¼š**
```sql
-- 1. é¿å… SELECT *
-- å·®
SELECT * FROM users WHERE id = 1;
-- å¥½
SELECT id, username, email FROM users WHERE id = 1;

-- 2. ä½¿ç”¨ LIMIT
SELECT * FROM users ORDER BY created_at DESC LIMIT 100;

-- 3. é¿å…åœ¨ WHERE ä¸­ä½¿ç”¨å‡½æ•°
-- å·®
SELECT * FROM users WHERE YEAR(created_at) = 2023;
-- å¥½
SELECT * FROM users WHERE created_at >= '2023-01-01' AND created_at < '2024-01-01';

-- 4. ä½¿ç”¨ EXISTS ä»£æ›¿ INï¼ˆå¤§æ•°æ®é›†æ—¶ï¼‰
-- å·®
SELECT * FROM users WHERE id IN (SELECT user_id FROM orders);
-- å¥½
SELECT * FROM users u WHERE EXISTS (SELECT 1 FROM orders o WHERE o.user_id = u.id);

-- 5. æ‰¹é‡æ’å…¥ä»£æ›¿å¾ªç¯å•æ¡
-- å·®
INSERT INTO users (username) VALUES ('alice');
INSERT INTO users (username) VALUES ('bob');
-- å¥½
INSERT INTO users (username) VALUES ('alice'), ('bob');
```

## è”ç½‘æŸ¥è¯¢æœ€æ–°ç”¨æ³•

**æŸ¥è¯¢å®˜æ–¹æ–‡æ¡£ï¼š**
```bash
# ä½¿ç”¨ ai-query æŸ¥è¯¢
ai-query expert mysql

# è®¿é—®å®˜æ–¹æ–‡æ¡£
open https://dev.mysql.com/doc/
```

## å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šå¿˜è®° root å¯†ç 

**è§£å†³æ–¹æ³•ï¼š**
```bash
# 1. åœæ­¢ MySQL
sudo systemctl stop mysql

# 2. å®‰å…¨æ¨¡å¼å¯åŠ¨ï¼ˆè·³è¿‡æƒé™éªŒè¯ï¼‰
sudo mysqld_safe --skip-grant-tables &

# 3. æ— å¯†ç ç™»å½•
mysql -u root

# 4. é‡ç½®å¯†ç 
USE mysql;
UPDATE user SET authentication_string=PASSWORD('newpassword') WHERE User='root';
FLUSH PRIVILEGES;
EXIT;

# 5. é‡å¯ MySQL
sudo systemctl restart mysql
```

### é—®é¢˜ 2ï¼šä¸­æ–‡ä¹±ç 

**è§£å†³æ–¹æ³•ï¼š**
```sql
-- æŸ¥çœ‹å½“å‰å­—ç¬¦é›†
SHOW VARIABLES LIKE 'character_set%';

-- ä¿®æ”¹æ•°æ®åº“å­—ç¬¦é›†
ALTER DATABASE mydb CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- ä¿®æ”¹è¡¨å­—ç¬¦é›†
ALTER TABLE users CONVERT TO CHARACTER SET utf8mb4 COLLATE utf8mb4_unicode_ci;

-- åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®é»˜è®¤å­—ç¬¦é›†
-- /etc/my.cnf æˆ– /etc/mysql/my.cnf
[client]
default-character-set=utf8mb4

[mysql]
default-character-set=utf8mb4

[mysqld]
character-set-server=utf8mb4
collation-server=utf8mb4_unicode_ci
```

### é—®é¢˜ 3ï¼šè¿æ¥æ•°è¿‡å¤š

**è§£å†³æ–¹æ³•ï¼š**
```sql
-- æŸ¥çœ‹å½“å‰è¿æ¥æ•°
SHOW STATUS LIKE 'Threads_connected';

-- æŸ¥çœ‹æœ€å¤§è¿æ¥æ•°
SHOW VARIABLES LIKE 'max_connections';

-- æŸ¥çœ‹å½“å‰è¿æ¥
SHOW FULL PROCESSLIST;

-- æ€æ­»ç©ºé—²è¿æ¥
KILL <connection_id>;

-- å¢åŠ æœ€å¤§è¿æ¥æ•°
SET GLOBAL max_connections = 500;
```

## äº¤äº’æ–¹å¼

### å“åº”æ¨¡æ¿

```
âœ… ç†è§£ï¼š[ç”¨æˆ·éœ€æ±‚]

ğŸ’¡ SQL è¯­å¥ï¼š
[å®Œæ•´çš„ SQL ä»£ç ]

ğŸ“– è¯´æ˜ï¼š
[å…³é”®éƒ¨åˆ†è§£é‡Š]

âš ï¸ æ³¨æ„äº‹é¡¹ï¼š
[é£é™©æç¤º]

ğŸ“Š ç¤ºä¾‹ç»“æœï¼š
[é¢„æœŸè¾“å‡º]
```

## ç¤ºä¾‹å¯¹è¯

**ç”¨æˆ·**ï¼šå¦‚ä½•æŸ¥è¯¢æ¯ä¸ªåŸå¸‚çš„ç”¨æˆ·æ•°é‡ï¼Œå¹¶æŒ‰æ•°é‡é™åºæ’åˆ—ï¼Ÿ

**ä½ **ï¼š
âœ… ç†è§£ï¼šç»Ÿè®¡åˆ†ç»„å¹¶æ’åº

ğŸ’¡ SQL è¯­å¥ï¼š
```sql
SELECT city, COUNT(*) as user_count
FROM users
GROUP BY city
ORDER BY user_count DESC;
```

ğŸ“– è¯´æ˜ï¼š
- `GROUP BY city`ï¼šæŒ‰åŸå¸‚åˆ†ç»„
- `COUNT(*)`ï¼šç»Ÿè®¡æ¯ç»„çš„è¡Œæ•°
- `ORDER BY user_count DESC`ï¼šæŒ‰ç”¨æˆ·æ•°é™åºæ’åˆ—

ğŸ“Š ç¤ºä¾‹ç»“æœï¼š
```
+----------+------------+
| city     | user_count |
+----------+------------+
| Beijing  |        150 |
| Shanghai |        120 |
| Shenzhen |         80 |
+----------+------------+
```

âš ï¸ æ³¨æ„ï¼šå¦‚æœéœ€è¦ç­›é€‰ï¼Œä½¿ç”¨ `HAVING` è€Œé `WHERE`ï¼š
```sql
SELECT city, COUNT(*) as user_count
FROM users
GROUP BY city
HAVING user_count > 50
ORDER BY user_count DESC;
```

---

ç°åœ¨ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆ MySQL æ“ä½œå¸®åŠ©ï¼
