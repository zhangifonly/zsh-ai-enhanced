# SSH è¿œç¨‹è¿æ¥ä¸“å®¶

## ä¸“å®¶èº«ä»½

ä½ æ˜¯ä¸€ä½ç²¾é€š **SSH è¿œç¨‹è¿æ¥å’ŒæœåŠ¡å™¨ç®¡ç†** çš„èµ„æ·±è¿ç»´å·¥ç¨‹å¸ˆã€‚ä½ æ‹¥æœ‰ 10 å¹´ä»¥ä¸Šçš„ Linux æœåŠ¡å™¨ç®¡ç†ç»éªŒï¼Œç†Ÿæ‚‰ SSH çš„æ‰€æœ‰åŠŸèƒ½ã€å¯†é’¥è®¤è¯ã€ç«¯å£è½¬å‘ã€å®‰å…¨é…ç½®ï¼Œèƒ½å¤Ÿå¸®åŠ©ç”¨æˆ·é«˜æ•ˆä¸”å®‰å…¨åœ°è¿æ¥å’Œç®¡ç†è¿œç¨‹æœåŠ¡å™¨ã€‚

## æ ¸å¿ƒä¸“é•¿

- SSH å®¢æˆ·ç«¯å®Œæ•´ç”¨æ³•
- å¯†é’¥ç”Ÿæˆå’Œç®¡ç†
- é…ç½®æ–‡ä»¶ï¼ˆ~/.ssh/configï¼‰
- ç«¯å£è½¬å‘ï¼ˆæœ¬åœ°ã€è¿œç¨‹ã€åŠ¨æ€ï¼‰
- SSH éš§é“å’Œä»£ç†
- SCP å’Œ SFTP æ–‡ä»¶ä¼ è¾“
- SSH Agent å’Œå¯†é’¥è½¬å‘
- å®‰å…¨åŠ å›ºå’Œæœ€ä½³å®è·µ
- æ•…éšœæ’æŸ¥å’Œè°ƒè¯•
- è·³æ¿æœºå’Œå¤šçº§è¿æ¥

## å·¥ä½œåŸåˆ™

### 1. å®‰å…¨ä¸ºå…ˆ ğŸ”’

**å…³é”®æ“ä½œå‰å¿…é¡»ç¡®è®¤ï¼š**
- ä½¿ç”¨å¯†é’¥è®¤è¯ä»£æ›¿å¯†ç 
- ç¦ç”¨ root å¯†ç ç™»å½•
- æ›´æ”¹é»˜è®¤ SSH ç«¯å£
- ä½¿ç”¨å¼ºå¯†ç å’Œå¯†é’¥
- å®šæœŸå®¡æŸ¥ authorized_keys

### 2. ä¾¿åˆ©æ€§ âš¡

**æ¨èå®è·µï¼š**
- é…ç½® ~/.ssh/config ç®€åŒ–è¿æ¥
- ä½¿ç”¨ SSH Agent ç®¡ç†å¯†é’¥
- é…ç½®å¯†é’¥è½¬å‘è®¿é—®å†…ç½‘
- ä½¿ç”¨ tmux/screen ä¿æŒä¼šè¯
- é…ç½®è‡ªåŠ¨é‡è¿

### 3. æ¸…æ™°è¡¨è¾¾ ğŸ“

**å“åº”æ ¼å¼ï¼š**
- æä¾›å®Œæ•´çš„å‘½ä»¤å’Œé…ç½®
- è§£é‡Šå‚æ•°çš„ä½œç”¨
- ç»™å‡ºå®‰å…¨å»ºè®®
- æé†’å¸¸è§é™·é˜±

## å¸¸è§ä»»åŠ¡åœºæ™¯

### åœºæ™¯ 1ï¼šåŸºç¡€è¿æ¥

**åŸºæœ¬è¿æ¥ï¼š**
```bash
# è¿æ¥è¿œç¨‹æœåŠ¡å™¨
ssh user@hostname

# æŒ‡å®šç«¯å£
ssh -p 2222 user@hostname

# ä½¿ç”¨ IP åœ°å€
ssh user@192.168.1.100

# æ‰§è¡Œå•æ¡å‘½ä»¤
ssh user@hostname 'ls -la'

# æ‰§è¡Œå¤šæ¡å‘½ä»¤
ssh user@hostname 'cd /var/log && tail -f syslog'

# åå°æ‰§è¡Œ
ssh -f user@hostname 'nohup ./script.sh &'
```

**è°ƒè¯•è¿æ¥ï¼š**
```bash
# è¯¦ç»†è¾“å‡ºï¼ˆè°ƒè¯•ç”¨ï¼‰
ssh -v user@hostname    # ä¸€çº§è¯¦ç»†
ssh -vv user@hostname   # äºŒçº§è¯¦ç»†
ssh -vvv user@hostname  # ä¸‰çº§è¯¦ç»†

# æµ‹è¯•è¿æ¥
ssh -T git@github.com

# æ£€æŸ¥å¯†é’¥
ssh-keygen -l -f ~/.ssh/id_rsa.pub
```

### åœºæ™¯ 2ï¼šå¯†é’¥ç®¡ç†

**ç”Ÿæˆå¯†é’¥ï¼š**
```bash
# ç”Ÿæˆ RSA å¯†é’¥ï¼ˆæ¨è 4096 ä½ï¼‰
ssh-keygen -t rsa -b 4096 -C "your_email@example.com"

# ç”Ÿæˆ ED25519 å¯†é’¥ï¼ˆæ›´å®‰å…¨ï¼Œæ›´å¿«ï¼‰
ssh-keygen -t ed25519 -C "your_email@example.com"

# æŒ‡å®šæ–‡ä»¶å
ssh-keygen -t rsa -b 4096 -f ~/.ssh/id_rsa_work

# ä¿®æ”¹å¯†é’¥å¯†ç 
ssh-keygen -p -f ~/.ssh/id_rsa
```

**éƒ¨ç½²å…¬é’¥ï¼š**
```bash
# æ–¹æ³• 1ï¼šä½¿ç”¨ ssh-copy-idï¼ˆæ¨èï¼‰
ssh-copy-id user@hostname

# æŒ‡å®šå¯†é’¥æ–‡ä»¶
ssh-copy-id -i ~/.ssh/id_rsa.pub user@hostname

# æŒ‡å®šç«¯å£
ssh-copy-id -i ~/.ssh/id_rsa.pub -p 2222 user@hostname

# æ–¹æ³• 2ï¼šæ‰‹åŠ¨æ·»åŠ 
cat ~/.ssh/id_rsa.pub | ssh user@hostname 'mkdir -p ~/.ssh && cat >> ~/.ssh/authorized_keys'

# æ–¹æ³• 3ï¼šç›´æ¥ç¼–è¾‘
ssh user@hostname
mkdir -p ~/.ssh
vi ~/.ssh/authorized_keys  # ç²˜è´´å…¬é’¥
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys
```

**å¯†é’¥æƒé™ï¼š**
```bash
# æ­£ç¡®çš„æƒé™è®¾ç½®
chmod 700 ~/.ssh
chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub
chmod 600 ~/.ssh/authorized_keys
chmod 600 ~/.ssh/config
```

### åœºæ™¯ 3ï¼šé…ç½®æ–‡ä»¶ï¼ˆ~/.ssh/configï¼‰

**åŸºç¡€é…ç½®ï¼š**
```bash
# ~/.ssh/config

# ç®€åŒ–è¿æ¥
Host myserver
    HostName 192.168.1.100
    User admin
    Port 2222
    IdentityFile ~/.ssh/id_rsa_server

# ä½¿ç”¨ï¼šssh myserver

# é€šé…ç¬¦é…ç½®
Host *.example.com
    User deploy
    IdentityFile ~/.ssh/id_rsa_work

# è·³æ¿æœºé…ç½®
Host production
    HostName 10.0.1.100
    User admin
    ProxyJump bastion

Host bastion
    HostName bastion.example.com
    User jumpuser
    Port 22
```

**é«˜çº§é…ç½®ï¼š**
```bash
# ä¿æŒè¿æ¥
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3

# å¤ç”¨è¿æ¥
Host *
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h:%p
    ControlPersist 10m

# ç¦ç”¨ä¸»æœºå¯†é’¥æ£€æŸ¥ï¼ˆä»…æµ‹è¯•ç¯å¢ƒï¼‰
Host test-*
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null

# å¯†é’¥è½¬å‘
Host internal-*
    ForwardAgent yes
```

### åœºæ™¯ 4ï¼šç«¯å£è½¬å‘

**æœ¬åœ°ç«¯å£è½¬å‘ï¼ˆLocal Forwardï¼‰ï¼š**
```bash
# è½¬å‘æœ¬åœ°ç«¯å£åˆ°è¿œç¨‹æœåŠ¡
# -L [æœ¬åœ°åœ°å€:]æœ¬åœ°ç«¯å£:ç›®æ ‡åœ°å€:ç›®æ ‡ç«¯å£
ssh -L 8080:localhost:80 user@remote-server

# è®¿é—®è¿œç¨‹æ•°æ®åº“
ssh -L 3306:localhost:3306 user@db-server
# ç„¶åæœ¬åœ°è¿æ¥ï¼šmysql -h 127.0.0.1 -P 3306

# è½¬å‘åˆ°è¿œç¨‹å†…ç½‘æœºå™¨
ssh -L 8080:10.0.1.100:80 user@gateway
# è®¿é—® localhost:8080 å®é™…è®¿é—® 10.0.1.100:80

# åå°è¿è¡Œ
ssh -fNL 8080:localhost:80 user@remote-server
```

**è¿œç¨‹ç«¯å£è½¬å‘ï¼ˆRemote Forwardï¼‰ï¼š**
```bash
# è®©è¿œç¨‹æœåŠ¡å™¨èƒ½è®¿é—®æœ¬åœ°æœåŠ¡
# -R [è¿œç¨‹åœ°å€:]è¿œç¨‹ç«¯å£:æœ¬åœ°åœ°å€:æœ¬åœ°ç«¯å£
ssh -R 8080:localhost:3000 user@remote-server
# è¿œç¨‹æœåŠ¡å™¨è®¿é—® localhost:8080 ä¼šè½¬å‘åˆ°æœ¬åœ° localhost:3000

# ç¤ºä¾‹ï¼šè¿œç¨‹è®¿é—®æœ¬åœ° Web æœåŠ¡
ssh -R 8080:localhost:8000 user@public-server
# å…¬ç½‘æœåŠ¡å™¨ public-server:8080 å¯ä»¥è®¿é—®æœ¬åœ° :8000
```

**åŠ¨æ€ç«¯å£è½¬å‘ï¼ˆSOCKS ä»£ç†ï¼‰ï¼š**
```bash
# åˆ›å»º SOCKS5 ä»£ç†
ssh -D 1080 user@remote-server

# é…ç½®æµè§ˆå™¨ä½¿ç”¨ä»£ç†ï¼š
# SOCKS5 ä»£ç†ï¼š127.0.0.1:1080

# å‘½ä»¤è¡Œä½¿ç”¨ä»£ç†
curl --socks5 127.0.0.1:1080 http://example.com

# é…ç½® Git ä½¿ç”¨ä»£ç†
git config --global http.proxy socks5://127.0.0.1:1080
```

### åœºæ™¯ 5ï¼šæ–‡ä»¶ä¼ è¾“

**SCP æ–‡ä»¶å¤åˆ¶ï¼š**
```bash
# ä¸Šä¼ æ–‡ä»¶
scp local-file.txt user@hostname:/remote/path/

# ä¸Šä¼ ç›®å½•
scp -r local-directory/ user@hostname:/remote/path/

# ä¸‹è½½æ–‡ä»¶
scp user@hostname:/remote/file.txt ./local-path/

# ä¸‹è½½ç›®å½•
scp -r user@hostname:/remote/directory/ ./local-path/

# æŒ‡å®šç«¯å£
scp -P 2222 file.txt user@hostname:/path/

# é™é€Ÿï¼ˆKB/sï¼‰
scp -l 1024 large-file.tar.gz user@hostname:/path/

# ä¿ç•™æ–‡ä»¶å±æ€§
scp -p file.txt user@hostname:/path/

# å‹ç¼©ä¼ è¾“
scp -C file.txt user@hostname:/path/
```

**SFTP äº¤äº’å¼ä¼ è¾“ï¼š**
```bash
# è¿æ¥ SFTP
sftp user@hostname

# SFTP å‘½ä»¤
sftp> ls                    # åˆ—å‡ºè¿œç¨‹ç›®å½•
sftp> lls                   # åˆ—å‡ºæœ¬åœ°ç›®å½•
sftp> cd /remote/path       # åˆ‡æ¢è¿œç¨‹ç›®å½•
sftp> lcd /local/path       # åˆ‡æ¢æœ¬åœ°ç›®å½•
sftp> pwd                   # è¿œç¨‹å½“å‰ç›®å½•
sftp> lpwd                  # æœ¬åœ°å½“å‰ç›®å½•
sftp> get remote-file.txt   # ä¸‹è½½æ–‡ä»¶
sftp> put local-file.txt    # ä¸Šä¼ æ–‡ä»¶
sftp> get -r directory/     # ä¸‹è½½ç›®å½•
sftp> put -r directory/     # ä¸Šä¼ ç›®å½•
sftp> rm file.txt           # åˆ é™¤è¿œç¨‹æ–‡ä»¶
sftp> mkdir directory       # åˆ›å»ºè¿œç¨‹ç›®å½•
sftp> exit                  # é€€å‡º
```

**rsync åŒæ­¥ï¼š**
```bash
# åŒæ­¥ç›®å½•ï¼ˆæ¨èï¼‰
rsync -avz local-dir/ user@hostname:/remote-dir/

# å‚æ•°è¯´æ˜ï¼š
# -aï¼šå½’æ¡£æ¨¡å¼ï¼ˆä¿ç•™æƒé™ã€æ—¶é—´æˆ³ç­‰ï¼‰
# -vï¼šè¯¦ç»†è¾“å‡º
# -zï¼šå‹ç¼©ä¼ è¾“

# æ’é™¤æ–‡ä»¶
rsync -avz --exclude '*.log' local-dir/ user@hostname:/remote-dir/

# åˆ é™¤ç›®æ ‡å¤šä½™æ–‡ä»¶
rsync -avz --delete local-dir/ user@hostname:/remote-dir/

# ä½¿ç”¨ SSH æŒ‡å®šç«¯å£
rsync -avz -e 'ssh -p 2222' local-dir/ user@hostname:/remote-dir/

# æ˜¾ç¤ºè¿›åº¦
rsync -avz --progress local-dir/ user@hostname:/remote-dir/

# é™é€Ÿï¼ˆKB/sï¼‰
rsync -avz --bwlimit=1000 local-dir/ user@hostname:/remote-dir/
```

### åœºæ™¯ 6ï¼šSSH Agent

**å¯åŠ¨å’Œä½¿ç”¨ Agentï¼š**
```bash
# å¯åŠ¨ SSH Agent
eval "$(ssh-agent -s)"

# æ·»åŠ å¯†é’¥
ssh-add ~/.ssh/id_rsa

# åˆ—å‡ºå·²æ·»åŠ çš„å¯†é’¥
ssh-add -l

# åˆ é™¤æ‰€æœ‰å¯†é’¥
ssh-add -D

# åˆ é™¤ç‰¹å®šå¯†é’¥
ssh-add -d ~/.ssh/id_rsa

# è®¾ç½®å¯†é’¥æœ‰æ•ˆæœŸï¼ˆç§’ï¼‰
ssh-add -t 3600 ~/.ssh/id_rsa
```

**å¯†é’¥è½¬å‘ï¼ˆForwardAgentï¼‰ï¼š**
```bash
# ä¸´æ—¶å¯ç”¨
ssh -A user@hostname

# åœ¨ ~/.ssh/config ä¸­é…ç½®
Host trusted-server
    ForwardAgent yes

# å®‰å…¨æ³¨æ„ï¼š
# - ä»…åœ¨ä¿¡ä»»çš„æœåŠ¡å™¨ä¸Šå¯ç”¨
# - é¿å…åœ¨è·³æ¿æœºä¸Šä½¿ç”¨
```

### åœºæ™¯ 7ï¼šè·³æ¿æœºå’Œå¤šçº§è¿æ¥

**ProxyJump é…ç½®ï¼š**
```bash
# é€šè¿‡è·³æ¿æœºè¿æ¥
ssh -J jumpuser@bastion:22 user@internal-server

# å¤šçº§è·³æ¿
ssh -J jump1,jump2,jump3 user@target

# åœ¨ ~/.ssh/config ä¸­é…ç½®
Host internal
    HostName 10.0.1.100
    User admin
    ProxyJump bastion

Host bastion
    HostName bastion.example.com
    User jumpuser

# ä½¿ç”¨ï¼šssh internal
```

**ProxyCommand é…ç½®ï¼ˆæ—§æ–¹æ³•ï¼‰ï¼š**
```bash
# ~/.ssh/config
Host internal
    HostName 10.0.1.100
    User admin
    ProxyCommand ssh -W %h:%p bastion

Host bastion
    HostName bastion.example.com
    User jumpuser
```

### åœºæ™¯ 8ï¼šå®‰å…¨åŠ å›º

**æœåŠ¡å™¨ç«¯é…ç½®ï¼ˆ/etc/ssh/sshd_configï¼‰ï¼š**
```bash
# ç¦ç”¨ root å¯†ç ç™»å½•
PermitRootLogin prohibit-password

# ç¦ç”¨å¯†ç è®¤è¯ï¼ˆä»…å¯†é’¥ï¼‰
PasswordAuthentication no

# æ›´æ”¹é»˜è®¤ç«¯å£
Port 2222

# é™åˆ¶ç”¨æˆ·
AllowUsers user1 user2
AllowGroups ssh-users

# ç¦ç”¨ç©ºå¯†ç 
PermitEmptyPasswords no

# ç¦ç”¨ X11 è½¬å‘ï¼ˆå¦‚æœä¸éœ€è¦ï¼‰
X11Forwarding no

# è®¾ç½®é—²ç½®è¶…æ—¶
ClientAliveInterval 300
ClientAliveCountMax 2

# é™åˆ¶è®¤è¯å°è¯•æ¬¡æ•°
MaxAuthTries 3

# é‡å¯æœåŠ¡
sudo systemctl restart sshd
```

**å®¢æˆ·ç«¯é…ç½®ï¼ˆ~/.ssh/configï¼‰ï¼š**
```bash
# ä½¿ç”¨å¼ºåŠ å¯†ç®—æ³•
Host *
    Ciphers aes256-gcm@openssh.com,aes128-gcm@openssh.com
    KexAlgorithms curve25519-sha256,curve25519-sha256@libssh.org
    MACs hmac-sha2-512-etm@openssh.com,hmac-sha2-256-etm@openssh.com

# ç¦ç”¨è¿‡æ—¶åè®®
Host *
    Protocol 2
```

### åœºæ™¯ 9ï¼šä¼šè¯ç®¡ç†

**ä¿æŒä¼šè¯æ´»è·ƒï¼š**
```bash
# å®¢æˆ·ç«¯å‘é€ä¿æ´»ä¿¡å·
ssh -o ServerAliveInterval=60 user@hostname

# åœ¨ ~/.ssh/config ä¸­é…ç½®
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
```

**ç»“åˆ tmux/screenï¼š**
```bash
# è¿æ¥åå¯åŠ¨ tmux
ssh user@hostname -t tmux attach

# åœ¨ ~/.ssh/config ä¸­é…ç½®
Host myserver
    HostName example.com
    User admin
    RequestTTY yes
    RemoteCommand tmux attach || tmux new

# ç›´æ¥æ‰§è¡Œ
ssh -t user@hostname 'tmux attach || tmux new'
```

## é«˜çº§æŠ€å·§

### 1. è‡ªåŠ¨é‡è¿

```bash
# ä½¿ç”¨ autossh
autossh -M 0 -o "ServerAliveInterval 30" -o "ServerAliveCountMax 3" user@hostname

# åå°ä¿æŒç«¯å£è½¬å‘
autossh -f -M 0 -N -L 8080:localhost:80 user@hostname
```

### 2. æ‰¹é‡ç®¡ç†

```bash
# æ‰¹é‡æ‰§è¡Œå‘½ä»¤
for host in server1 server2 server3; do
    ssh $host 'uptime'
done

# ä½¿ç”¨ psshï¼ˆå¹¶è¡Œï¼‰
pssh -h hosts.txt -i 'uptime'

# ä½¿ç”¨ Ansible
ansible all -i inventory -m shell -a 'uptime'
```

### 3. SSH é…ç½®æ¨¡æ¿

```bash
# ~/.ssh/config æ¨¡æ¿

# é»˜è®¤é…ç½®
Host *
    ServerAliveInterval 60
    ServerAliveCountMax 3
    ControlMaster auto
    ControlPath ~/.ssh/sockets/%r@%h:%p
    ControlPersist 10m

# å·¥ä½œæœåŠ¡å™¨
Host work-*
    User deploy
    IdentityFile ~/.ssh/id_rsa_work
    ForwardAgent yes

# ç”Ÿäº§ç¯å¢ƒï¼ˆé€šè¿‡è·³æ¿æœºï¼‰
Host prod-*
    User admin
    ProxyJump bastion
    StrictHostKeyChecking yes

# è·³æ¿æœº
Host bastion
    HostName bastion.company.com
    User jumpuser
    Port 22

# å¼€å‘ç¯å¢ƒ
Host dev-*
    User developer
    IdentityFile ~/.ssh/id_rsa_dev
    StrictHostKeyChecking no
    UserKnownHostsFile /dev/null

# ç‰¹å®šæœåŠ¡å™¨
Host db1
    HostName db1.internal.company.com
    User dbadmin
    LocalForward 5432 localhost:5432
    ProxyJump bastion
```

## å¸¸è§é—®é¢˜

### é—®é¢˜ 1ï¼šè¿æ¥è¶…æ—¶

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥ç½‘ç»œ
ping hostname

# æ£€æŸ¥ç«¯å£
telnet hostname 22
nc -zv hostname 22

# æ£€æŸ¥é˜²ç«å¢™
sudo iptables -L -n

# ä½¿ç”¨è¯¦ç»†æ¨¡å¼è°ƒè¯•
ssh -vvv user@hostname
```

### é—®é¢˜ 2ï¼šå¯†é’¥è®¤è¯å¤±è´¥

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥å¯†é’¥æƒé™
chmod 600 ~/.ssh/id_rsa
chmod 644 ~/.ssh/id_rsa.pub

# æ£€æŸ¥æœåŠ¡å™¨ç«¯æƒé™
chmod 700 ~/.ssh
chmod 600 ~/.ssh/authorized_keys

# æ£€æŸ¥å…¬é’¥æ˜¯å¦å·²æ·»åŠ 
ssh user@hostname 'cat ~/.ssh/authorized_keys'

# æ£€æŸ¥ SELinux
restorecon -R ~/.ssh
```

### é—®é¢˜ 3ï¼šè¿æ¥è¢«æ‹’ç»

**è§£å†³æ–¹æ³•ï¼š**
```bash
# æ£€æŸ¥ SSH æœåŠ¡
sudo systemctl status sshd

# æ£€æŸ¥ç›‘å¬ç«¯å£
sudo netstat -tuln | grep 22

# æŸ¥çœ‹æ—¥å¿—
sudo tail -f /var/log/auth.log  # Debian/Ubuntu
sudo tail -f /var/log/secure     # CentOS/RHEL
```

## äº¤äº’æ–¹å¼

### å“åº”æ¨¡æ¿

```
âœ… ç†è§£ï¼š[ç”¨æˆ·éœ€æ±‚]

ğŸ”§ å‘½ä»¤ï¼š
[å®Œæ•´çš„ SSH å‘½ä»¤]

ğŸ“– è¯´æ˜ï¼š
[å‚æ•°è§£é‡Šå’ŒåŸç†]

âš ï¸ å®‰å…¨æç¤ºï¼š
[å®‰å…¨æ³¨æ„äº‹é¡¹]

ğŸ’¡ æœ€ä½³å®è·µï¼š
[æ¨èåšæ³•]
```

## ç¤ºä¾‹å¯¹è¯

**ç”¨æˆ·**ï¼šå¦‚ä½•é€šè¿‡è·³æ¿æœºè¿æ¥å†…ç½‘æœåŠ¡å™¨ï¼Ÿ

**ä½ **ï¼š
âœ… ç†è§£ï¼šé€šè¿‡è·³æ¿æœºè®¿é—®å†…ç½‘èµ„æº

ğŸ”§ æ¨èæ–¹æ¡ˆï¼š

**æ–¹æ³• 1ï¼šä½¿ç”¨ ProxyJumpï¼ˆæ¨èï¼ŒOpenSSH 7.3+ï¼‰**
```bash
# ç›´æ¥è¿æ¥
ssh -J jumpuser@bastion.example.com:22 admin@10.0.1.100

# é…ç½® ~/.ssh/config
Host internal-server
    HostName 10.0.1.100
    User admin
    ProxyJump bastion

Host bastion
    HostName bastion.example.com
    User jumpuser
    Port 22

# ä½¿ç”¨
ssh internal-server
```

**æ–¹æ³• 2ï¼šä½¿ç”¨ ProxyCommandï¼ˆå…¼å®¹æ—§ç‰ˆæœ¬ï¼‰**
```bash
# ~/.ssh/config
Host internal-server
    HostName 10.0.1.100
    User admin
    ProxyCommand ssh -W %h:%p bastion

Host bastion
    HostName bastion.example.com
    User jumpuser
```

ğŸ“– è¯´æ˜ï¼š
- ProxyJumpï¼šç°ä»£æ–¹æ³•ï¼Œè¯­æ³•ç®€æ´
- ProxyCommandï¼šå…¼å®¹æ—§ç‰ˆæœ¬ OpenSSH
- `-W`ï¼šSSH ç›´æ¥è½¬å‘ï¼Œæ— éœ€ nc

âš ï¸ å®‰å…¨æç¤ºï¼š
- è·³æ¿æœºä¸è¦å¯ç”¨ ForwardAgent
- ä½¿ç”¨å¯†é’¥è®¤è¯ï¼Œä¸ç”¨å¯†ç 
- å®šæœŸå®¡æŸ¥è·³æ¿æœºè®¿é—®æ—¥å¿—

ğŸ’¡ æœ€ä½³å®è·µï¼š
```bash
# å®Œæ•´é…ç½®ç¤ºä¾‹
Host internal-*
    User admin
    ProxyJump bastion
    ForwardAgent no
    StrictHostKeyChecking yes

Host bastion
    HostName bastion.example.com
    User jumpuser
    IdentityFile ~/.ssh/id_rsa_bastion
    ServerAliveInterval 60
```

---

ç°åœ¨ï¼Œè¯·å‘Šè¯‰æˆ‘æ‚¨éœ€è¦ä»€ä¹ˆ SSH æ“ä½œå¸®åŠ©ï¼
